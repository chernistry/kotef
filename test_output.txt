
> kotef@0.1.0 test:e2e
> npm run build && tsx --test test/e2e.test.ts


> kotef@0.1.0 build
> tsc && cp -r src/agent/prompts dist/agent/

Running: KOTEF_API_KEY=dummy KOTEF_MOCK_MODE=true /Users/sasha/IdeaProjects/personal_projects/kotef/bin/kotef run --root /Users/sasha/IdeaProjects/personal_projects/kotef/temp-e2e/hello-world --ticket 01-add-function --goal "Add a subtract function"
▶ E2E Tests
  ✖ should solve hello-world ticket (338.701416ms)
Running: KOTEF_API_KEY=dummy KOTEF_MOCK_MODE=true /Users/sasha/IdeaProjects/personal_projects/kotef/bin/kotef run --root /Users/sasha/IdeaProjects/personal_projects/kotef/temp-e2e/hello-world-nosdd --goal "Add a subtract function"
  ✖ should bootstrap SDD for new project (1070.607084ms)
✖ E2E Tests (1414.525208ms)
ℹ tests 2
ℹ suites 1
ℹ pass 0
ℹ fail 2
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 1543.996166

✖ failing tests:

test at test/e2e.test.ts:1:686
✖ should solve hello-world ticket (338.701416ms)
  Error: Command failed: KOTEF_API_KEY=dummy KOTEF_MOCK_MODE=true /Users/sasha/IdeaProjects/personal_projects/kotef/bin/kotef run --root /Users/sasha/IdeaProjects/personal_projects/kotef/temp-e2e/hello-world --ticket 01-add-function --goal "Add a subtract function"
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Run failed: Recursion limit of 25 reached without hitting a stop condition. You can increase the limit by setting the "recursionLimit" config key.
  
  Troubleshooting URL: https://docs.langchain.com/oss/javascript/langgraph/GRAPH_RECURSION_LIMIT/
  
  
      at genericNodeError (node:internal/errors:998:15)
      at wrappedFn (node:internal/errors:543:14)
      at ChildProcess.exithandler (node:child_process:417:12)
      at ChildProcess.emit (node:events:508:28)
      at maybeClose (node:internal/child_process:1085:16)
      at ChildProcess._handle.onexit (node:internal/child_process:304:5) {
    code: 1,
    killed: false,
    signal: null,
    cmd: 'KOTEF_API_KEY=dummy KOTEF_MOCK_MODE=true /Users/sasha/IdeaProjects/personal_projects/kotef/bin/kotef run --root /Users/sasha/IdeaProjects/personal_projects/kotef/temp-e2e/hello-world --ticket 01-add-function --goal "Add a subtract function"',
    stdout: '{"ts":"2025-11-24T10:31:53.868Z","level":"info","message":"Starting kotef run","runId":"dedc38d1-e210-415d-90e7-0963da86c420","rootDir":"/Users/sasha/IdeaProjects/personal_projects/kotef/temp-e2e/hello-world","goal":"Add a subtract function","ticket":"01-add-function"}\n{"ts":"2025-11-24T10:31:53.870Z","level":"info","message":"Loading SDD artifacts...","runId":"dedc38d1-e210-415d-90e7-0963da86c420"}\n{"ts":"2025-11-24T10:31:53.872Z","level":"info","message":"Building and running agent graph...","runId":"dedc38d1-e210-415d-90e7-0963da86c420"}\n{"ts":"2025-11-24T10:31:53.899Z","level":"error","message":"Run failed","runId":"dedc38d1-e210-415d-90e7-0963da86c420","error":"Recursion limit of 25 reached without hitting a stop condition. You can increase the limit by setting the \\"recursionLimit\\" config key.\\n\\nTroubleshooting URL: https://docs.langchain.com/oss/javascript/langgraph/GRAPH_RECURSION_LIMIT/\\n","stack":"GraphRecursionError: Recursion limit of 25 reached without hitting a stop condition. You can increase the limit by setting the \\"recursionLimit\\" config key.\\n\\nTroubleshooting URL: https://docs.langchain.com/oss/javascript/langgraph/GRAPH_RECURSION_LIMIT/\\n\\n    at CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1148:46)\\n    at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)"}\nRun report written to: /Users/sasha/IdeaProjects/personal_projects/kotef/temp-e2e/hello-world/.sdd/runs/2025-11-24T10-31-53-899Z_dedc38d1-e210-415d-90e7-0963da86c420.md\n',
    stderr: `Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)\n    at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)\n    at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)\n    at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)\n    at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)\n    at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)\n    at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)\n    at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)\nFailed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)\n    at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)\n    at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)\n    at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)\n    at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)\n    at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)\n    at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)\n    at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)\nFailed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)\n    at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)\n    at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)\n    at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)\n    at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)\n    at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)\n    at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)\n    at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)\nFailed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)\n    at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)\n    at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)\n    at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)\n    at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)\n    at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)\n    at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)\n    at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)\nFailed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)\n    at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)\n    at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)\n    at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)\n    at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)\n    at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)\n    at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)\n    at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)\nFailed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)\n    at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)\n    at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)\n    at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)\n    at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)\n    at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)\n    at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)\n    at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)\nFailed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)\n    at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)\n    at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)\n    at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)\n    at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)\n    at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)\n    at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)\n    at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)\nFailed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)\n    at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)\n    at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)\n    at async _runWithRetry (file:///Users/sasha/IdeaPro`... 7678 more characters
  }

test at test/e2e.test.ts:1:1517
✖ should bootstrap SDD for new project (1070.607084ms)
  Error: Command failed: KOTEF_API_KEY=dummy KOTEF_MOCK_MODE=true /Users/sasha/IdeaProjects/personal_projects/kotef/bin/kotef run --root /Users/sasha/IdeaProjects/personal_projects/kotef/temp-e2e/hello-world-nosdd --goal "Add a subtract function"
  Failed to fetch https://example.com/mock for deep research: Error: Failed to fetch https://example.com/mock: 404 Not Found
      at fetchPage (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/tools/fetch_page.js:64:15)
      at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
      at async deepResearch (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/tools/deep_research.js:15:26)
      at async bootstrapSddForProject (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/bootstrap.js:35:30)
      at async Command.<anonymous> (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/cli.js:52:17)
  Deep research summarization failed: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at deepResearch (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/tools/deep_research.js:53:31)
      at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
      at async bootstrapSddForProject (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/bootstrap.js:35:30)
      at async Command.<anonymous> (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/cli.js:52:17)
  Failed to parse architect response SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at bootstrapSddForProject (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/bootstrap.js:52:26)
      at async Command.<anonymous> (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/cli.js:52:17)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Failed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON
      at JSON.parse (<anonymous>)
      at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)
      at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)
      at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)
      at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)
      at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)
      at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)
      at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)
      at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)
  Run failed: Recursion limit of 25 reached without hitting a stop condition. You can increase the limit by setting the "recursionLimit" config key.
  
  Troubleshooting URL: https://docs.langchain.com/oss/javascript/langgraph/GRAPH_RECURSION_LIMIT/
  
  
      at genericNodeError (node:internal/errors:998:15)
      at wrappedFn (node:internal/errors:543:14)
      at ChildProcess.exithandler (node:child_process:417:12)
      at ChildProcess.emit (node:events:508:28)
      at maybeClose (node:internal/child_process:1085:16)
      at ChildProcess._handle.onexit (node:internal/child_process:304:5) {
    code: 1,
    killed: false,
    signal: null,
    cmd: 'KOTEF_API_KEY=dummy KOTEF_MOCK_MODE=true /Users/sasha/IdeaProjects/personal_projects/kotef/bin/kotef run --root /Users/sasha/IdeaProjects/personal_projects/kotef/temp-e2e/hello-world-nosdd --goal "Add a subtract function"',
    stdout: '{"ts":"2025-11-24T10:31:54.195Z","level":"info","message":"Starting kotef run","runId":"8ee0b082-3af1-4976-abbd-ac6395cd6f0a","rootDir":"/Users/sasha/IdeaProjects/personal_projects/kotef/temp-e2e/hello-world-nosdd","goal":"Add a subtract function"}\n{"ts":"2025-11-24T10:31:54.196Z","level":"info","message":"SDD directory not found. Bootstrapping from goal...","runId":"8ee0b082-3af1-4976-abbd-ac6395cd6f0a"}\nBootstrapping SDD for /Users/sasha/IdeaProjects/personal_projects/kotef/temp-e2e/hello-world-nosdd with goal: "Add a subtract function"\n{"ts":"2025-11-24T10:31:54.933Z","level":"info","message":"Loading SDD artifacts...","runId":"8ee0b082-3af1-4976-abbd-ac6395cd6f0a"}\n{"ts":"2025-11-24T10:31:54.934Z","level":"info","message":"Building and running agent graph...","runId":"8ee0b082-3af1-4976-abbd-ac6395cd6f0a"}\n{"ts":"2025-11-24T10:31:54.964Z","level":"error","message":"Run failed","runId":"8ee0b082-3af1-4976-abbd-ac6395cd6f0a","error":"Recursion limit of 25 reached without hitting a stop condition. You can increase the limit by setting the \\"recursionLimit\\" config key.\\n\\nTroubleshooting URL: https://docs.langchain.com/oss/javascript/langgraph/GRAPH_RECURSION_LIMIT/\\n","stack":"GraphRecursionError: Recursion limit of 25 reached without hitting a stop condition. You can increase the limit by setting the \\"recursionLimit\\" config key.\\n\\nTroubleshooting URL: https://docs.langchain.com/oss/javascript/langgraph/GRAPH_RECURSION_LIMIT/\\n\\n    at CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1148:46)\\n    at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)"}\nRun report written to: /Users/sasha/IdeaProjects/personal_projects/kotef/temp-e2e/hello-world-nosdd/.sdd/runs/2025-11-24T10-31-54-965Z_8ee0b082-3af1-4976-abbd-ac6395cd6f0a.md\n',
    stderr: `Failed to fetch https://example.com/mock for deep research: Error: Failed to fetch https://example.com/mock: 404 Not Found\n    at fetchPage (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/tools/fetch_page.js:64:15)\n    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at async deepResearch (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/tools/deep_research.js:15:26)\n    at async bootstrapSddForProject (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/bootstrap.js:35:30)\n    at async Command.<anonymous> (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/cli.js:52:17)\nDeep research summarization failed: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at deepResearch (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/tools/deep_research.js:53:31)\n    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at async bootstrapSddForProject (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/bootstrap.js:35:30)\n    at async Command.<anonymous> (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/cli.js:52:17)\nFailed to parse architect response SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at bootstrapSddForProject (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/bootstrap.js:52:26)\n    at async Command.<anonymous> (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/cli.js:52:17)\nFailed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)\n    at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)\n    at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)\n    at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)\n    at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)\n    at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)\n    at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)\n    at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)\nFailed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)\n    at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)\n    at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)\n    at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)\n    at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)\n    at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)\n    at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)\n    at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)\nFailed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)\n    at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)\n    at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)\n    at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)\n    at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)\n    at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)\n    at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)\n    at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)\nFailed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)\n    at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)\n    at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)\n    at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)\n    at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)\n    at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)\n    at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)\n    at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)\nFailed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)\n    at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)\n    at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)\n    at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)\n    at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)\n    at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)\n    at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)\n    at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)\nFailed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)\n    at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/utils.js:39:22)\n    at async RunnableSequence.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/core/dist/runnables/base.js:944:21)\n    at async _runWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/retry.js:48:13)\n    at async PregelRunner._executeTasksWithRetry (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:140:24)\n    at async PregelRunner.tick (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/runner.js:61:49)\n    at async CompiledStateGraph._runLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1138:5)\n    at async createAndRunLoop (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_modules/@langchain/langgraph/dist/pregel/index.js:1037:5)\nFailed to parse planner JSON: SyntaxError: Unexpected token 'M', "Mock response" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at RunnableCallable.func (file:///Users/sasha/IdeaProjects/personal_projects/kotef/dist/agent/nodes/planner.js:43:29)\n    at async RunnableCallable.invoke (file:///Users/sasha/IdeaProjects/personal_projects/kotef/node_m`... 9278 more characters
  }
